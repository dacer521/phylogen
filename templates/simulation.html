{% extends 'base.html' %}

{% block title %}{{ biome_name|default('Evolution Simulator') }} - Phylogen{% endblock %}

{% block content %}
  <section class="simulation">
    <header class="simulation__header">
      <div class="simulation__title">
        <img src="{{ url_for('static', filename='images/phylogen-logo.png') }}"
             alt="Phylogen logo"
             class="simulation__logo">
        <div>
          <p class="simulation__eyebrow">Phylogen</p>
          <h1>{{ biome_name|default('Evolution Simulator') }}</h1>
        </div>
      </div>

      <div class="simulation__actions">
        <a href="{{ url_for('main.index') }}"
           class="simulation__control">
          Home
        </a>

        <button type="button"
                id="open-simulation-tour"
                class="simulation__control">
          How to play
        </button>

     

        <button type="button"
                id="start-simulation"
                class="simulation__control">
          Start Movement
        </button>
        <button type="button"
                id="toggle-animations"
                class="simulation__control simulation__control--secondary">
          Animations: On
        </button>
        <a href="{{ url_for('main.define_species', next=request.url, biome=biome_id) }}"
           id="define-organism"
           class="simulation__control">
          Define your own species
        </a>
         <button type="button"
                id="toggle-genome-display"
                class="simulation__control">
          Show Gene Notation
        </button>
      </div>
    </header>

    <div class="simulation__layout"
         style="--grid-rows: {{ map_grid.rows }}; --grid-cols: {{ map_grid.cols }};">


      <div class="map-panel"
           {% if biome_id == 'rainforest' %}
           style="background-image: url('{{ url_for('static', filename='images/backgrounds/jungle.png') }}');"
           {% endif %}>
           
        <div class="map-grid" role="grid" aria-label="Habitat map">
          {% for row in range(map_grid.rows) %}
            {% for col in range(map_grid.cols) %}
              {% set label = map_grid.label_lookup.get((row, col)) %}
              <div class="map-tile"
                   role="gridcell"
                   aria-label="Tile {{ row }} {{ col }}"
                   data-row="{{ row }}"
                   data-col="{{ col }}"
                   {% if label %}data-label="{{ label }}"{% endif %}>
                {% if label %}
                  <span class="map-label">{{ label }}</span>
                {% endif %}
              </div>
            {% endfor %}
          {% endfor %}
        </div>

        <div class="sprite-layer" aria-hidden="true">
          {% for level in trophic_levels %}
            {% for organism in level.organisms %}
              <div class="sprite sprite--animated"
                   id="{{ organism.id }}"
                   data-level="{{ level.id }}"
                   data-row="{{ organism.row }}"
                   data-col="{{ organism.col }}"
                   style="--sprite-row: {{ organism.row }};
                  --sprite-col: {{ organism.col }};
                  background-image: url('{{ url_for('static', filename=organism.imagePath) }}');">

                <span class="sprite__name">{{ organism.name }}</span>
              </div>

            {% endfor %} 
          {% endfor %}
        </div>
      </div>

      <aside class="sidebar">
        <h2>Trophic Levels</h2>

        <div class="trophic-levels">
          {% for level in trophic_levels %}
            <section class="trophic-level" data-level="{{ level.id }}">
              <header class="trophic-level__header">
                <h3>{{ level.name }}</h3>
                <span class="trophic-level__count">Population: {{ level.population_count }} individuals</span>
              </header>
              <ul class="trophic-level__list">
                {% for organism in level.organisms %}
                  <li onmouseover="highlightOrganism('{{ organism.id }}')"
                      onmouseleave="removeHighlightOrganism('{{ organism.id }}')">
                    <button type="button"
                            class="trophic-level__organism"
                            data-target-id="{{ organism.id }}">
                      <span class="trophic-level__organism-name">{{ organism.name }}</span>
                      <span class="trophic-level__organism-coords">
                        {{ '%02d' % organism.row }}, c{{ '%02d' % organism.col }}
                      </span>
                      <span class="trophic-level__organism-population">{{ organism.size }} individuals</span>
                      <span class="trophic-level__organism-genome">
                        <span class="trophic-level__organism-genome-text">Avg genome: n/a</span>
                        <span class="genome-tooltip-trigger"
                              role="button"
                              tabindex="0"
                              aria-label="What does this genotype notation mean?">?</span>
                        <span class="trophic-level__organism-genome_tooltip">
                          This notation refers to the average genotype of the species. Some traits are dominant and others are recessive. Homozygous dominant means two dominant alleles (TT, 0.75+), heterozygous means one dominant and one recessive allele (Tt, 0.25-0.75) , and homozygous recessive means two recessive alleles (tt,  0.25-).
                        </span>
                      </span>
                    </button>
                  </li>
                {% endfor %}
              </ul>
            </section>
          {% endfor %}
        </div>
      </aside>
    </div>

    <section class="simulation-tour"
             aria-hidden="true"
             role="dialog"
             aria-labelledby="simulation-tour-title">
      <div class="simulation-tour__backdrop" data-tour-action="close" aria-hidden="true"></div>
      <div class="simulation-tour__dialog">
        <header class="simulation-tour__header">
          <div>
            <p class="simulation-tour__eyebrow">Quick tour</p>
            <h2 id="simulation-tour-title">How to play Phylogen</h2>
            <p class="simulation-tour__lede">This is a walkthrough of how to play Phylogen!</p>
          </div>
          <button type="button"
                  class="simulation-tour__close"
                  data-tour-action="close"
                  aria-label="Close tutorial">
            &times;
          </button>
        </header>

        <div class="simulation-tour__slides" role="presentation">
          <article class="simulation-tour__slide is-active">
            <div class="simulation-tour__media">
              <div class="simulation-tour__media-placeholder"><img src = "../static/images/phylogen-logo.png" alt = "logo"></div>
            </div>
            <div class="simulation-tour__body">
              <p class="simulation-tour__label">Welcome</p>
              <h3>Phylogen is an Evoultion Simulator Game</h3>
              <p>Your goal is to define a species, or several species, and to have the eco-system survive! To see how to do this, hit next!</p>
            </div>
          </article>

          <article class="simulation-tour__slide">
            <div class="simulation-tour__media">
              <div class="simulation-tour__media-placeholder"><img src = "../static/images/controls.png" alt = "image of website with controls in a box"></div>
            </div>
            <div class="simulation-tour__body">
              <p class="simulation-tour__label">Navigation</p>
              <h3>Main controls</h3>
              <p>These five buttons define how you play the game! They allow you to view this tutorial again, begin the game, pause it, and to define your own species! By defining your species, you customize how YOU think a given organism should fit into its environment. </p>
            </div>
          </article>

          <article class="simulation-tour__slide">
            <div class="simulation-tour__media">
              <div class="simulation-tour__media-placeholder"><img src = "../static/images/form.png" alt = "webpage form"></div>
            </div>
            <div class="simulation-tour__body">
              <p class="simulation-tour__label">How to define species</p>
              <h3>Defining species</h3>
              <p>When you define a species, you are deciding how you think the animal should best fit into its environment. You will give each gene a number from 0-1 to say how high or low that trait should be expressed. A 0 is not having that trait at all, 1 is having that trait a lot, and 0.5 is in the middle. The better you guess its ideal traits, the better the animal will do! But, if you guess wrong, the animal will have difficulty surviving.</p>
            </div>
          </article>

           <article class="simulation-tour__slide">
            <div class="simulation-tour__media">
              <div class="simulation-tour__media-placeholder"><img src = "../static/images/phylogen-logo.png" alt = "webpage form"></div>
            </div>
            <div class="simulation-tour__body">
              <p class="simulation-tour__label">Playing the game</p>
              <h3>Good luck!</h3>
              <p>Now that you've learned all about how to play Phylogen, you are ready to go and fight the battle of nature. If you have any more questions, hit the question mark button on the home screen, or look up questions online. Best of luck, and remember to have fun!</p>
            </div>
          </article>

        </div>

        <footer class="simulation-tour__footer">
          <div class="simulation-tour__progress" aria-live="polite">
            <span data-tour-progress>1 / 4</span>
          </div>
          <div class="simulation-tour__controls">
            <button type="button"
                    class="simulation-tour__button simulation-tour__button--ghost"
                    data-tour-action="prev"
                    disabled>
              Previous
            </button>
            <div class="simulation-tour__dot-group" aria-hidden="true">
              <span class="simulation-tour__dot is-active"></span>
              <span class="simulation-tour__dot"></span>
              <span class="simulation-tour__dot"></span>
               <span class="simulation-tour__dot"></span>
            </div>
            <button type="button"
                    class="simulation-tour__button"
                    data-tour-action="next">
              Next
            </button>
          </div>
          <button type="button"
                  class="simulation-tour__skip"
                  data-tour-action="close">
            Skip for now
          </button>
        </footer>
      </div>
    </section>
  </section>
{% endblock %}
